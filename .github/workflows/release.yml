---
# SPDX-License-Identifier: MIT
#
# Copyright (c) 2025 Niladri Das
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.

name: release

on:
  push:
    branches: [main]

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    - name: check if version changed
      id: version_check
      run: |
        CURRENT_VERSION=$(cat VERSION)
        PREVIOUS_VERSION=$(git show HEAD~1:VERSION 2>/dev/null || echo "")
         if [ "$CURRENT_VERSION" != "$PREVIOUS_VERSION" ]; then
           echo "version_changed=true" >> "$GITHUB_OUTPUT"
           echo "new_version=$CURRENT_VERSION" >> "$GITHUB_OUTPUT"
         else
           echo "version_changed=false" >> "$GITHUB_OUTPUT"
         fi
    - name: create release
      if: steps.version_check.outputs.version_changed == 'true'
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        VERSION="${{ steps.version_check.outputs.new_version }}"
        gh release create "v${VERSION}" --title "v${VERSION}" --notes "Release ${VERSION}"
